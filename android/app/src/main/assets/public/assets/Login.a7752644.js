import{g as _,L as P,o as y,b as $,w as S,a as g,M as f,k as T,y as E,j as d,f as x,N as A,O as D,h as m,m as r,q as N,G as j,H as I,z as w,I as M,B as O,C as U,P as z,D as R,Q as V}from"./index.d6deafee.js";const J=d("div",{class:"flex justify-between w-full"},[d("span",null,[d("input",{type:"checkbox",checked:"checked",name:"remember"}),x(" \u8BB0\u4F4F\u5BC6\u7801 ")]),d("a",{href:"#"},"\u5FD8\u8BB0\u5BC6\u7801?")],-1),Z=_({__name:"LoginForm",props:{email:null,password:null,delay:null},emits:["login","update:email","update:password"],setup(o,{emit:s}){const u=P(()=>{s("login")},o.delay);return(i,e)=>{const t=A,n=D;return y(),$(n,{"form-label":"\u767B\u9646","btn-name":"\u767B\u9646",onSubmit:e[4]||(e[4]=T(a=>E(u)(a),["prevent"]))},{default:S(()=>[g(t,{data:o.email,"onUpdate:data":e[0]||(e[0]=a=>f(email)?email.value=a:null),placeholder:"\u90AE\u7BB1",reg:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,type:"email","data-tip":"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1",value:o.email,onInput:e[1]||(e[1]=a=>i.$emit("update:email",a.target.value))},null,8,["data","reg","value"]),g(t,{data:o.password,"onUpdate:data":e[2]||(e[2]=a=>f(password)?password.value=a:null),placeholder:"\u5BC6\u7801",type:"password",value:o.password,reg:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/,"data-tip":"\u5BC6\u7801\u81F3\u5C11\u5305\u542B \u6570\u5B57\u548C\u82F1\u6587,\u957F\u5EA66-20",onInput:e[3]||(e[3]=a=>i.$emit("update:password",a.target.value))},null,8,["data","value","reg"]),J]),_:1})}}});let B={token:"",userId:"",name:"",expiryDate:""};const q=o=>{let s=m(null),u=m(!1);return{error:s,login:async(e,t)=>{if(s.value=null,u.value=!0,!(e||t))throw new Error(`email : ${e!=null?e:null}, password: ${t!=null?t:null}`);try{const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(n.status!==200&&n.status!==201){const a=await n.json();throw new Error(a.message)}return B=await n.json(),s.value=null,u.value=!1,B}catch(n){s.value=n.message,u.value=!1}},isPending:u}},G=_({__name:"Login",setup(o){const s=m(""),u=m(""),i="https://my-32541.herokuapp.com/api/auth/login",e=M(),t=O(),n=q(i),a=r(n,"error"),h=r(n,"login");let F=N();const b=j();r(b,"posts");const{setLocal:C}=V();I(()=>{F.value=!0});const L=async()=>{t.value.isPending=!0;const c=U(),l=r(c,"open"),v=r(c,"close");l.value();const p=await h.value(s.value,u.value);if(!a.value)z(t.value,p),C(JSON.stringify(t.value)),e.push("/");else{const k=R();r(k,"open").value(a.value),console.log(a.value)}v.value(),t.value.isPending=!1};return(c,l)=>{const v=Z;return y(),$(v,{email:s.value,"onUpdate:email":l[0]||(l[0]=p=>s.value=p),password:u.value,"onUpdate:password":l[1]||(l[1]=p=>u.value=p),novalidate:"",delay:1e3,onLogin:L,class:"form",isPending:t.value.isPending},null,8,["email","password","isPending"])}}});typeof w=="function"&&w(G);export{G as default};
